@startuml Application Flow
!theme plain
skinparam backgroundColor transparent

title Oracle Nexus - Application Flow

actor User as U
participant "Frontend" as FE
participant "LLM Controller" as Controller
participant "Stack Overflow Client" as SOClient
participant "LLM Client" as LLMClient
participant "Search Progress" as Progress
participant "WebSocket" as WS
participant "Ollama" as Ollama
participant "Stack Overflow API" as SOAPI

== Search Request ==
U -> FE : Enter search query
FE -> Controller : POST /api/search_rerank
Controller -> Progress : Broadcast search start
Progress -> WS : Real-time update
WS -> FE : "Starting search..."

== Progressive Search ==
Controller -> SOClient : Search with original terms
SOClient -> SOAPI : API request
SOAPI -> SOClient : Return questions/answers

alt If no results
  Controller -> LLMClient : Simplify query
  LLMClient -> Ollama : Generate simpler terms
  Ollama -> LLMClient : Simplified query
  Controller -> SOClient : Search with new terms
  SOClient -> SOAPI : Retry search
end

== AI Re-ranking ==
Controller -> LLMClient : Rerank answers
LLMClient -> Ollama : Analyze relevance
Ollama -> LLMClient : Reordered answers + explanations
LLMClient -> Controller : AI-ranked results

== Response ==
Controller -> FE : Return results\n{original_answers, reranked_answers}
FE -> U : Display with tabs

@enduml